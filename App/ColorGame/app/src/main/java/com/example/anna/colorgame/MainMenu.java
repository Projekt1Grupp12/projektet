package com.example.anna.colorgame;import android.app.ProgressDialog;import android.content.Intent;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.util.Log;import android.view.View;import android.widget.Button;/*Class is an activity that shows main menu of the application.It has three TextView to show data. */public class MainMenu extends AppCompatActivity {    private static final String TAG = "debugMenu";    private Player player;    private Button chooseGameBtn;    private Class nextActivity = null;    private ConnectToServer runner;    private RecieveDataThread recieveDataThread;    private Thread thread;    private ProgressDialog pd;    private boolean start=false;    private AsyncResponse delegate = new AsyncResponse() {        /*        Method that has result from AsyncTask as parameter.        It is used to get result from Asynctask and store it in userID variable.        And at last sendMessageToNextActivity method is called.         */        @Override        public void postResult(String result) {            Log.d(TAG, "RESULTAT FRÃ…N SERVER " + result);            if (result.contains("ok")) {                //do nothing            }           /* if(result.contains("Game")) {//server sends responce for example "PuzzleGame", String contains game and if statement is true.                chooseGameBtn.setEnabled(true);                if (result.contains(("Puzzle Game"))) {//if server sends PuzzleGame start PuzzleGame                    Log.d(TAG, "Start puzzlegame " + result);                    nextActivity = PuzzleGame.class;                }else if (result.contains(("Traffic Game"))) {                    nextActivity = TrafficGame.class;                }else if (result.contains(("Duel Game"))) {                    nextActivity = DuelGame.class;                }            }*/            /* if(result.contains("SocketTimeoutException")){                startAsyncTask("join?;1");            }            if(result.contains("-1")) {                startAsyncTask("join?;1");                Log.d(TAG, "postResult else: " + result);            }*/        }    };    @Override    protected void onCreate(Bundle savedInstanceState) {        Log.i(TAG, "onCreate(). MainMenu");        super.onCreate(savedInstanceState);        setContentView(R.layout.main_menu);        Intent intent = getIntent();        player = (Player)intent.getSerializableExtra("player");        recieveDataThread = new RecieveDataThread(this, player, this);//added thread 05-16        thread = new Thread(recieveDataThread);        thread.start();        //Text on the Button change depending on userID        chooseGameBtn = (Button) findViewById(R.id.choose_game_button);        if(player.getUserID().equals("0")){            chooseGameBtn.setText("Choose Game");        }else if(player.getUserID().equals("1")){            chooseGameBtn.setText("Join Game");            chooseGameBtn.setEnabled(false);        }    }    @Override    protected void onResume() {        Log.d(TAG, "onResume() ");        super.onResume();    }    @Override    protected void onRestart() {        Log.d(TAG, "onRestart() ");        super.onRestart();    }    @Override    protected void onStop(){        Log.d(TAG, "onStop() ");        recieveDataThread.setIsRunning(false);        thread.interrupt();        Log.d(TAG, "is Interrupted & is Alive?");        //thread = null;        //System.gc();        Log.d(TAG, String.valueOf(thread.isInterrupted()));        Log.d(TAG, String.valueOf(thread.isAlive()));        super.onStop();    }    @Override    protected void onDestroy() {//added 05-16 for thread        Log.d(TAG, "onDestroy() ");        finish();//do we need this method?        super.onDestroy();    }    /**     * This method is called when button "Choose Game" is clicked.     * It starts next activity and sends data to it using Intent class.     * @param view     */    public void chooseGame(View view){        Log.d(TAG, "Button Choose Game or Join Game is clicked");        Intent intent = null;        if (player.getUserID().equals("0")) {            intent = new Intent(this, ChooseGame.class);            intent.putExtra("player", player);            startActivity(intent);        }        if (player.getUserID().equals("1")) {            startAsyncTask("ready;1");//sending message to server            startProgressDialog("Starting...");        }        if (player == null) {            Log.d(TAG, "Player null");        }    }    private void startProgressDialog(String message){        pd = new ProgressDialog(MainMenu.this);        pd.setProgressStyle(pd.STYLE_SPINNER);        pd.setMessage(message);        pd.show();    }    public void startGame() {        Intent intent = null;        pd.dismiss();//when start=true, start next activity        intent = new Intent(this, nextActivity);        intent.putExtra("player", player);        startActivity(intent);    }    public void setButtonActive(){ this.chooseGameBtn.setEnabled(true);}//is used in a while loop    public void setNextActivityGame(String str) {        if (str.contains(("PuzzleGame"))) {//if server sends PuzzleGame start PuzzleGame            nextActivity = PuzzleGame.class;        } else if (str.contains(("TrafficGame"))) {            nextActivity = TrafficGame.class;        } else if (str.contains(("DuelGame"))) {            nextActivity = DuelGame.class;        }    }    public void showHighScore(View view) {}    public void startAsyncTask(String message) {        runner = new ConnectToServer(player.getChoosenIP(), delegate);        Log.d(TAG, "Task created");        runner.execute(message);    }}